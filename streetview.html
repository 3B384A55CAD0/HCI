<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
		<title>HCI - Visual Paths</title>
		<link rel="stylesheet" type="text/css" href="css/visualPaths.css" />
		<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCscKVyBTkwd83mGUN9J-BU459rgpfDlpc&sensor=false"></script>
		<link rel="stylesheet" href="http://code.jquery.com/ui/1.9.2/themes/base/jquery-ui.css" />
    	<script src="http://code.jquery.com/jquery-1.8.3.js"></script>
    	<script src="http://code.jquery.com/ui/1.9.2/jquery-ui.js"></script>
		<script type="text/javascript" src="scripts/visualPaths.js"></script>
		<script type="text/javascript">
			
			var isSliding = false;
			var uiEffectTime = 500;
			
			// MAIN
			$(document).ready(function() {
				var canvas = $("#map_canvas")[0];
				var streetViewCanvas = $("#map_streetview")[0]
				
				visualPaths.movementStep = 10;
				visualPaths.init(canvas, true, stepCallback, onFinishCallback);		
				
				$("#playButton").click(function() {
					if ($("#playButton").val() == 'Play') {
						play();
					}
					else {
						pause();
					}
				});
				$("#stopButton").click(stop);
				$("#pauseButton").click(pause);
							
				$("#fromText").keyup(checkFromAndTo);
				$("#toText").keyup(checkFromAndTo);
				
				$("#slider").slider({
					range: "min",
					min: 0,
					max: 1,
					value: 0,
				}).show();
				
				$("#map_canvas").addClass("extended", uiEffectTime);
				$("#toolBox").addClass("extended", uiEffectTime);
				
			});

			function play() {
				
				if ($("#fromText").val() == "" || $("#toText").val() == "") return;

				if (visualPaths.paused){
					//$("#playButton").attr("disabled", "disabled");
					$("#stopButton").removeAttr("disabled");
					$("#playButton").attr('value', 'Pause');
					//$("#pauseButton").removeAttr("disabled");
					$("#fromText").attr("disabled", "disabled");
					$("#toText").attr("disabled", "disabled");

					//$("#toolBox").addClass("extended", uiEffectTime);
					//$("#map_canvas").addClass("extended", uiEffectTime);
					visualPaths.play();
				} else { // when it is stopped or the first time
					visualPaths.calculateRoute($("#fromText").val(), $("#toText").val(), function(existAPath){

						if (existAPath) {

							//$("#playButton").attr("disabled", "disabled");
							$("#playButton").attr('value', 'Pause');
							$("#stopButton").removeAttr("disabled");
							//$("#pauseButton").removeAttr("disabled");
							$("#fromText").attr("disabled", "disabled");
							$("#toText").attr("disabled", "disabled");
							
							//$("#toolBox").addClass("extended", uiEffectTime);
							//$("#map_canvas").addClass("extended", uiEffectTime);
							
							
							$("#slider").slider({
								range: "min",
								min: 0,
								max: visualPaths.totalDistance - 1,
								value: 0,
								//change: sliderChanged,
								start: function () { isSliding = true } ,
								stop: function () { isSliding = false; sliderChanged(); }
							}).show();
				
							visualPaths.play();	
						}
						else {
							$("#errorLabel").html("Sorry, No routes has been found!");
							$("#errorLabel").fadeIn(uiEffectTime);
						}

					});
				}
				
			}

			function stop() {
				visualPaths.stop();
				$("#playButton").attr('value', 'Play');
				$("#stopButton").attr("disabled", "disabled");
				$("#pauseButton").attr("disabled", "disabled");
				$("#playButton").removeAttr("disabled");
				$("#fromText").removeAttr("disabled");
				$("#toText").removeAttr("disabled");
				//$("#slider").hide();
				//$("#map_canvas").removeClass("extended", uiEffectTime);
				//$("#toolBox").removeClass("extended", uiEffectTime);
			}

			function pause() {
				visualPaths.pause();
				$("#pauseButton").attr("disabled", "disabled");
				//$("#playButton").removeAttr("disabled");
				$("#playButton").attr('value', 'Play');
			}

			function sliderChanged() {
				visualPaths.coveredDistance = $("#slider").slider("value");
				if (visualPaths.paused){
					visualPaths.paused = false;
					visualPaths.animatePath();
					visualPaths.paused = true;
				}
			}

			/* Called at each step of the animation */
			function stepCallback() {
				if (!isSliding)
					$("#slider").slider("value", visualPaths.coveredDistance);
			}

			function onFinishCallback() {
				$("#stopButton").attr("disabled", "disabled");
				$("#playButton").attr('value', 'Play');
				//$("#pauseButton").attr("disabled", "disabled");
				//$("#playButton").removeAttr("disabled");
				$("#fromText").removeAttr("disabled");
				$("#toText").removeAttr("disabled");
				//$("#slider").hide();
				//$("#map_canvas").removeClass("extended", uiEffectTime);
				//$("#toolBox").removeClass("extended", uiEffectTime);
			}
			
			/* Checks input forms "From" and "To" */
			function checkFromAndTo() {
				$("#errorLabel").fadeOut(uiEffectTime);
				//if (($("#fromText").val().length > 0) && ($("#toText").val().length > 0)) {
					//$("#playButton").removeAttr("disabled");
					//if((event.keyCode ? event.keyCode : event.which) == 13) play();
				//}
			}

		</script>		
	</head>
	<body>
		<div id="container"> 
			<div id="map_canvas"></div>		
			
			<div id="toolBox">
				<input type="text" placeholder="From" id="fromText"/>
				<input type="text" placeholder="To" id="toText"/>
				<input type="button" value="Play" id="playButton" style="width: 50px;"/>
				<input type="button" value="Stop" disabled="disabled" id="stopButton"/>
				<!--input type="button" value="Pause" disabled="disabled" id="pauseButton"/-->
				<span id="errorLabel">Error</span>
				<div id="slider"></div>
			</div>
		</div>
	</body>
</html>
